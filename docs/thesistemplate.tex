%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                                                %%
%% An example for writting your thesis using LaTeX                %%
%% Original version by Luis Costa,  changes by Perttu Puska       %%
%% Support for Swedish added 15092014                             %%
%%                                                                %%
%% This example consists of the files                             %%
%%         thesistemplate.tex (versio 2.0)                        %%
%%         opinnaytepohja.tex (versio 2.0) (for text in Finnish)  %%
%%         aaltothesis.cls (versio 2.0)                           %%
%%         kuva1.eps                                              %%
%%         kuva2.eps                                              %%
%%         kuva1.pdf                                              %%
%%         kuva2.pdf                                              %%
%%                                                                %%
%%                                                                %%
%% Typeset either with                                            %%
%% latex:                                                         %%
%%             $ latex opinnaytepohja                             %%
%%             $ latex opinnaytepohja                             %%
%%                                                                %%
%%   Result is the file opinnayte.dvi, which                      %%
%%   is converted to ps format as follows:                        %%                         %%
%%                                                                %%
%%             $ dvips opinnaytepohja -o                          %%
%%                                                                %%
%%   and then to pdf as follows:                                  %%
%%                                                                %%
%%             $ ps2pdf opinnaytepohja.ps                         %%
%%                                                                %%
%% Or                                                             %%
%% pdflatex:                                                      %%
%%             $ pdflatex opinnaytepohja                          %%
%%             $ pdflatex opinnaytepohja                          %%
%%                                                                %%
%%   Result is the file opinnaytepohja.pdf                        %%
%%                                                                %%
%% Explanatory comments in this example begin with                %%
%% the characters %%, and changes that the user can make          %%
%% with the character %                                           %%
%%                                                                %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Uncomment one of these, if you write in English:
%% the 1st when using pdflatex, which directly typesets your document in
%% pdf (use jpg or pdf figures), or
%% the 2nd when producing a ps file (use eps figures, don't use ps figures!).
\documentclass[english,12pt,a4paper,pdftex,sci,utf8]{aaltothesis}
%\documentclass[english,12pt,a4paper,dvips]{aaltothesis}

%% To the \documentclass above
%% specify your school: arts, biz, chem, elec, eng, sci
%% specify the character encoding scheme used by your editor: utf8, latin1

\usepackage{graphicx}

\usepackage{enumitem}

%% Use this if you write hard core mathematics, these are usually needed
\usepackage{amsfonts,amssymb,amsbsy}

%% Use the macros in this package to change how the hyperref package below 
%% typesets its hypertext -- hyperlink colour, font, etc. See the package
%% documentation. It also defines the \url macro, so use the package when 
%% not using the hyperref package.

%\usepackage{url}

%% Use this if you want to get links and nice output. Works well with pdflatex.
\usepackage{hyperref}

\usepackage{subfig}
\captionsetup[table]{aboveskip=12pt}
\captionsetup[table]{belowskip=2pt}

\setlength{\tabcolsep}{6pt}
\renewcommand{\arraystretch}{1.5}

\setlength{\parindent}{0em}
\setlength{\parskip}{1em}

\hypersetup{pdfpagemode=UseNone, pdfstartview=FitH,
  colorlinks=true,urlcolor=red,linkcolor=blue,citecolor=black,
  pdftitle={Default Title, Modify},pdfauthor={Your Name},
  pdfkeywords={Modify keywords}}
  

\usepackage[utf8]{inputenc}
\usepackage{glossaries}
\makeglossaries
\newglossaryentry{RCS}
{
    name=RCS,
    description={Revision control system}
}
\newglossaryentry{LOC}
{
    name=LOC,
    description={Lines of code}
}


%% All that is printed on paper starts here
\begin{document}

%% Change the school field to specify your school if the automatically 
%% set name is wrong
%%
%% Korjaa vastaamaan korkeakouluasi, jos automaattisesti asetettu nimi on 
%% virheellinen 
% \university{aalto-yliopisto}
% \university{aalto University}
% \school{Sähkötekniikan korkeakoulu}
% \school{School of Electrical Engineering}

%% Only for B.Sc. thesis: Choose your degree programme. 
\degreeprogram{Service Design and Engineering}
%\degreeprogram{Elektroniikka ja sähkötekniikka}
%%

%% ONLY FOR M.Sc. AND LICENTIATE THESIS: Specify your department,
%% professorship and professorship code. 
\department{Department of Computer Science and Engineering}
%\department{Radiotieteen ja -tekniikan laitos}

%\professorship{Circuit theory}
%\professorship{Piiriteoria}
%\code{S-55}
%%

%% Valitse yksi näistä kolmesta
%%
%% Choose one of these:
%\univdegree{BSc}
\univdegree{MSc}
%\univdegree{Lic}

%% Oma nimi
%%
%% Should be self explanatory...
\author{Ömer Furkan Tercan}

%% Your thesis title comes here and again before a possible abstract in
%% Finnish or Swedish . If the title is very long and latex does an
%% unsatisfactory job of breaking the lines, you will have to force a
%% linebreak with the \\ control character. 
%% Do not hyphenate titles.

\thesistitle{Software Refactoring Rationale in Agile Development: A Case Study in a Lean Startup}

\place{Espoo}

%% For B.Sc. thesis use the date when you present your thesis. 
%% 
%% Kandidaatintyön päivämäärä on sen esityspäivämäärä! 
\date{31.03.2015}

%% B.Sc. or M.Sc. thesis supervisor 
%% Note the "\" after the comma. This forces the following space to be 
%% a normal interword space, not the space that starts a new sentence. 
%% This is done because the fullstop isn't the end of the sentence that
%% should be followed by a slightly longer space but is to be followed
%% by a regular space.
%%
%% Kandidaattiseminaarin vastuuopettaja tai diplomityön valvoja.
%% Huomaa tittelissä "\" -merkki pisteen jälkeen, 
%% ennen välilyöntiä ja seuraavaa merkkijonoa. 
%% Näin tehdään, koska kyseessä ei ole lauseen loppu, jonka jälkeen tulee 
%% hieman pidempi väli vaan halutaan tavallinen väli.
\supervisor{Assoc. Prof. Casper Lassenius} %{Prof.\ Pirjo Professori}

%% B.Sc. or M.Sc. thesis advisors(s). You can give upto two advisors in
%% this template. Check with your supervisor how many official advisors
%% you can have.
%%
%% Kandidaatintyön ohjaaja(t) tai diplomityön ohjaaja(t). Ohjaajia saa
%% olla korkeintaan kaksi.
%% 
%\advisor{Prof.\ Pirjo Professori}
%\advisor{D.Sc.\ (Tech.) Olli Ohjaaja}
%\advisor{M.Sc. Advisor}

%% Aalto logo: syntax:
%% Aaltologo: syntaksi:
%%
%% \uselogo{aaltoRed|aaltoBlue|aaltoYellow|aaltoGray|aaltoGrayScale}{?|!|''}
%%
%% Logo language is set to be the same as the document language.
%% Logon kieli on sama kuin dokumentin kieli
%%
\uselogo{aaltoRed}{''}

%% Create the coverpage
%%
%% Tehdään kansilehti
\makecoverpage


%% Note that when writting your master's thesis in English, place
%% the English abstract first followed by the possible Finnish abstract

%% English abstract.
%% All the information required in the abstract (your name, thesis title, etc.)
%% is used as specified above.
%% Specify keywords
%%
%% Kaikki tiivistelmässä tarvittava tieto (nimesi, työnnimi, jne.) käytetään
%% niin kuin se on yllä määritelty.
%% Avainsanat
%%
\keywords{refactoring, code smells, anti-patterns, agile, lean}
%% Abstract text
\begin{abstractpage}[english]
What is refactoring? What is the goal of refactoring?

-

What is the role of software refactoring in agile development? What is the developer's perception of refactoring? What does the literature say about refactoring rationale? How does these to views match? What is the scope of this study?

-

How does this thesis conduct a study to answer the research questios? What is the research context in a sentence? What is the research methodology in summary?

-

What are the key findings? Limitations and future work?
\end{abstractpage}

%% Preface
%\mysection{Preface}
%\vspace{5cm}
%Otaniemi, 31.03.2013

%\vspace{5mm}
%{\hfill Ömer Furkan Tercan \hspace{1cm}}

\newpage


%% Table of contents. 
\thesistableofcontents

\newpage

%%Glossary - abbreviations
\printglossaries

\newpage

\listoftables


%% Corrects the page numbering, there is no need to change these
\cleardoublepage
\storeinipagenumber
\pagenumbering{arabic}
\setcounter{page}{1}


%% Text body begins. Note that since the text body
%% is mostly in Finnish the majority of comments are
%% also in Finnish after this point. There is no point in explaining
%% Finnish-language specific thesis conventions in English. Someday 
%% this text will possibly be translated to English.
%%
%% Leip\"ateksti alkaa
\section{Introduction} \label{introduction}
In this chapter section \ref{background} presents the background and motivation of this study. Following section \ref{scope} presents the scope of the thesis. Section \ref{questions} introduces the objective and research questions. Finally, section \ref{structure} summarizes the structure of this document. 
\subsection{Background and motivation} \label{background}
What is refactoring? Why and how critical is it for software development. What does the literature say about it's importance. If we scope it a bit down, what is the view of agile development to these questions?

What is the tricky part when deciding on what and how much to refactor? Is this hard to define. Does it highly depend on the context? How credible is what the literature say about drivers on refactoring decisions. Is there a research gap to reveal empirical findings in order to contribute to the scientific knowledge regarding refactoring rationale?

What would be the benefits, once we know more about refactoring rationale? What does the literature say about it's possible benefits? Take into account different viewpoints (customers, developers, etc.).

Discuss the relevant literature. Have this specific topic been investigated? What are the touching points? Which areas of the topic will be overlapped (and why) in this study? What would be the additional contribution? Why does this contribution make sense?

How do you claim to achieve this contribution? Summarize the research process. Why does it make sense to conduct the study in such a research context? 

Motivated by the findings in earlier studies, this thesis investigates the refactoring rationale in a lean startup ICT company. Attention has been paid to understand the drivers behind refactoring decisions in the company's agile development process. The results of the case study is analyzed, discussed and the most significant findings are compared with the scientific knowledge regarding software refactoring rationale. We will also discuss the issues which needs more thorough investigation and research in the future.

This study also contains a literature review chapter. In chapter \ref{literature}, we will discuss software refactoring and refactoring rationale as it is described in the literature. Then, we will explore refactoring drivers defined by the scientific knowledge, including anti-patterns and code smells.

\subsection{Scope of the thesis} \label{scope}

\subsection{Objective and research questions} \label{questions}
According to the motivation stated in section \ref{background}, there is need to investigate and reveal the correlation between how literature have conceptualized software refactoring rationale and how it is actually percieved by developers. Accordingly, an empirical study can be conducted investigating refactoring decisions in a case company. The empirical results can then be further analyzed and compared with the scientific knowledge regarding software refactoring rationale. 

This motivation leads to the main study objective:

\textbf{Objective:} Study refactoring rationale, particularly how it is perceived by the scientific knowledge versus agile software developers, to identify neglected threats to software evolution.

The following research questions were derived based on the main objective:

\begin{enumerate}[label=\textbf{RQ\arabic*}]
\item What does literature say about refactoring and when it is needed?

This research question tries to investigate relevant literature to form a basis on refactoring, in particular to present a refactoring rationale taxonomy based on related work.
\item How does developers perceive refactoring rationale?

This research question is of explorative nature and it tries to find empirical evidence on refactoring rational, taking into account the human factor. 
\item What does the correlation of the two reveal in terms of threats to software evolution?

This research question aims to discuss how well the developer's perception fits to the presented taxonomy. Based on this discussion, it aims to identify neglected threats to software evolution.
\end{enumerate}

\subsection{Structure of the thesis} \label{structure}
%% In a thesis, every section starts a new page, hence \clearpage
\clearpage

\section{Research setting} \label{research setting}

The main objective of this study is to gain an understanding on refactoring rationale, in particular how it is described in the relevant literature versus how it is perceived by agile software developers. Thus, identify neglected threats to software evolution. 

The objective is targeted in terms of a) studying relevant literature to form a basis on refactoring, particularly on refactoring rationale, b) finding empirical evidence on how refactoring rationale is percieved by developers, and c) discussing the inclusionary nature of the literature study and empirical findings. The relation of these studies to the research questions is presented in Table \ref{table:researchQuestions}.

\begin{table}[ht!]
\centering
\caption{Relation between studies and research questions}
\label{table:researchQuestions}
    \begin{tabular}{ p{10cm} m{2cm} m{2cm}  }
     \hline
     \textbf{Research question}  &\textbf{Literature}  &\textbf{Empirical}  \\
     \hline
     RQ1: What does literature say about refactoring and when it is needed?                         &X      &-  \\
     \hline
     RQ2: How does developers perceive refactoring rationale?                                       &-      &X  \\
     \hline
     RQ3: What does the correlation of the two reveal in terms of threats to software evolution?    &x      &x  \\
     \hline
    \end{tabular}
\centering
\caption*{  \textbf{Legend}: "X" indicates higher emphasis then "x", while "-" indicates inessential}
\end{table}

Finding an answer to RQ1 requires a literature study. This research question aims to present a software refactoring rationale taxonomy, which will act as a building stone when answering RQ3.

Finding an answer to RQ2 through a real world investigation overlaps with Yin's (2003) definition of a case study --- an empirical method aimed at investigating contemporary phenomena in their context. Similarly, the findings will act as a building stone when answering RQ3.

RQ3 aims to study the correlation between RQ1 and RQ2. In addition, it conducts a minor literature study on software evolution, to reveal neglected threats by taking the studied correlation into account.

\subsection{Case company} \label{caseCompany}
The case study was conducted in a lean start-up ICT company based in Helsinki, Finland. The company is producing  telecommunication application services enabling video calling from multiple endpoints, including web browsers, smart TV's and mobile devices. 
\subsubsection*{Software under study} \label{software}
The service platform consists of a server backend and multiple client endpoints. However, the scope this study includes the server backend and two of the clients. Therefore, the three components scoped within this study consists of:

\begin{enumerate}[label=\textbf{C\arabic*}]
\item The server component presented in Table \ref{table:serverLoc}, was implemented using javascript, particularly using nodejs.

\item An android client component presented in Table \ref{table:androidLoc}, was implemented using java.
    
\item A web client component presented in Table \ref{table:webLoc}, was implemented using javascript, particularly using angularjs.
\end{enumerate}

\begin{table}[ht!]
\centering
\caption{Server component; number of files and \gls{LOC}}
\label{table:serverLoc}
    \begin{tabular}{ |p{3cm} p{2cm} p{2cm} p{2cm} p{2cm}|  }
     \hline
     Language       &Files  &Blank  &Comment    &Code\\
     \hline
     \hline
     Javascript     &36     &582    &131        &4059\\
     Json           &4      &1      &0          &251\\
     Python         &5      &72     &46         &213\\
     Html           &1      &0      &1          &43\\
     Shell          &2      &21     &5          &39\\
     \hline\hline
     Sum            &48     &676    &183        &4605\\
     \hline
    \end{tabular}
\end{table}

\begin{table}[ht!]
\centering
\caption{Android client component; number of files and \gls{LOC}}
\label{table:androidLoc}
    \begin{tabular}{ |p{3cm} p{2cm} p{2cm} p{2cm} p{2cm}|  }
     \hline
     Language       &Files  &Blank  &Comment    &Code\\
     \hline\hline
     Xml            &707    &2687   &4921       &25950\\
     Java           &143    &2699   &5873       &15078\\
     Shell          &2      &50     &21         &237\\
     \hline\hline
     Sum            &852    &5436   &10815      &41265\\
     \hline
    \end{tabular}
\end{table}

\begin{table}[ht!]
\centering
\caption{Web client component; number of files and \gls{LOC}}
\label{table:webLoc}
    \begin{tabular}{ |p{3cm} p{2cm} p{2cm} p{2cm} p{2cm}|  }
     \hline
     Language&Files&Blank&Comment&Code\\
     \hline\hline
     Javascript   & 37    &542&   161&3631\\
     Less&   15  & 275   &10 & 1359\\
     Html &24 & 58&  17&540\\
     Json    &2 & 0&  0 & 0\\
     \hline\hline
     Sum&78&875&188&5606\\
     \hline
    \end{tabular}
\end{table}
\subsubsection*{Development process} \label{process}
The organization is a lean startup, having a lean development flow employing most of the agile development practices. Practices worth mentioning includes; continuous integration and deployment, continuous improvement (process and software quality), efficient and face-to-face communication, peer reviews, one peace flow, pair programming, testing as an integral part of development, and collective code ownership.

As it is a key principle of lean development, in ensuring continuous integration and deployment, continuous software quality improvement takes place routinely but critically within the organization. In particular, software refactoring serves as the main approach in this context.  

The empirical study was introduced to the developers during continuous process improvement meetings, named as retrospectives. As part of the study, developers were requested to put addition attention in reporting their refactoring related tasks. Collective code ownership and peer reviews were routine practices at present. Therefore, developers were already used to report their daily tasks using the source-code revision control system \gls{RCS}. 

\subsubsection*{Developers} \label{developers}
All developers of the organization participated in the empirical study. During this period, 6 developers reported their refactoring tasks in the source code revision control system.

<<A figure presenting developers and their work experience levels>>

\subsubsection{Data collection} \label{data collection}
Data was gathered from a single source. The single source of information was stored in the source-code \gls{RCS}. Developers have reported their refactoring related tasks via the source-code \gls{RCS}. Since collective code ownership and peer reviews where routine practices already, this extra duty required almost no extra effort from developers. 

Prior to the empirical data collection kick-off, several group discussions were conducted to motivate developers to highlight their refactoring tasks in their notes and to place useful conventions for data collection and analysis. In order to ease the data collection and analysis process, a convention of labeling their reports was introduced to developers.

Developers were using git as the source-code \gls{RCS}. Therefore, developers highlighted their refactoring tasks using git commit messages and git code line comments. Subsequently, a public API offered by the cloud-based git repository service was used to retrieve the commit messages, commit changes, and code line comments. The API offered json as a response format. Therefore, it made it trivial to collect, filter, further analyze and categorize refactoring tasks based on developer notes.  

In the cases were developer notes lacked sufficient amount of detail on the rational behind a refactoring decision, informal communication was used to resolve the ambiguity. Thanks to a) peer reviews with short feedback loops, b) efficient and face-to-face communication possibility, and c) technical reviews following short iterations, ambiguous developer notes were minimized. 

\subsubsection{Data analysis} \label{data analysis}
How was the data filtered, cleaned, and categorized? What tools and analysis methods were used?

\clearpage

\section{Literature study} \label{literature}
\subsection{Software refactoring}
\subsection{Refactoring rationale}

%\clearpage

\section{Case study} \label{case study}

%\clearpage

\section{Discussions} \label{discussions}
\section{Conclusions} \label{conclusions}
\subsection{Threads to Validity} \label{validity}
\subsection{Future Work} \label{future}

\clearpage
%% The \phantomsection command is nessesary for hyperref to jump to the 
%% correct page, in other words it puts a hyper marker on the page.

\phantomsection
\addcontentsline{toc}{section}{\refname}
%\addcontentsline{toc}{section}{References}
\begin{thebibliography}{99}

%\bibitem{Kauranen} Kauranen,\ I., Mustakallio,\ M. ja Palmgren,\ V.
%  \textit{Tutkimusraportin kirjoittamisen opas opinn\"aytety\"on
%    tekij\"oille.}  Espoo, Teknillinen korkeakoulu, 2006.

%\bibitem{Itkonen} Itkonen,\ M. \textit{Typografian k\"asikirja.} 3.\
%  painos.  Helsinki, RPS-yhti\"ot, 2007.

%\bibitem{Koblitz} Koblitz,\ N. \textit{A Course in Number Theory and
%    Cryptography. Graduate Texts in Mathematics 114.}  2.\ painos. New
%  York, Springer, 1994.
  
%\bibitem{bcs} Bardeen,\ J., Cooper,\ L.\ N. ja Schrieffer,\ J.\ R.
%  Theory of Superconductivity. \textit{Physical Review,} 1957, vol.\
%  108, nro~5, s.\ 1175--1204.

%\bibitem{viittaaminen} Kilpel\"ainen,\ P. WWW-l\"ahteisiin viittaaminen
%  tutkielmatekstiss\"a. Verkkodokumentti. P\"aivitetty 26.11.2001.
%  Viitattu 19.1.2007. Saatavissa:
%  \url{http://www.cs.uku.fi/~kilpelai/wwwlahteet.html.}

\end{thebibliography}

\end{document}
